language: android
jdk:
    - oraclejdk8
android:
  components:
    # The BuildTools version used by NewPipe
    - tools
    - build-tools-28.0.3

    # The SDK version used to compile NewPipe
    - android-28

before_install: 
  - yes | sdkmanager "platforms;android-28"
  - echo -e "machine github.com\n  login newpipe-machine-user\n  password $CI_USER_PASSWORD" > ~/.netrc
  - echo -e "machine api.github.com\n  login newpipe-machine-user\n  password $CI_USER_PASSWORD" >> ~/.netrc
  - chmod 600 ~/.netrc
  - chmod +x ./dev-scripts/uploadApkAndCommentOnPR.sh
script: ./gradlew -Dorg.gradle.jvmargs=-Xmx1536m assembleDebug lintDebug testDebugUnitTest

after_success:
  - ./dev-scripts/uploadApkAndCommentOnPR.sh
